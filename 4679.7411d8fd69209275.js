"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4679],{4679:(j,f,a)=>{a.r(f),a.d(f,{HomePageModule:()=>$});var b=a(6895),r=a(5616),F=a(4719),T=a(2895),Z=a(5861),m=a(529),P=a(2654);class H extends P.w{constructor(n,t){super()}schedule(n,t=0){return this}}let C=(()=>{class o{constructor(t,i=o.now){this.SchedulerAction=t,this.now=i}schedule(t,i=0,s){return new this.SchedulerAction(this,t).schedule(s,i)}}return o.now=()=>Date.now(),o})();class d extends C{constructor(n,t=C.now){super(n,()=>d.delegate&&d.delegate!==this?d.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(n,t=0,i){return d.delegate&&d.delegate!==this?d.delegate.schedule(n,t,i):super.schedule(n,t,i)}flush(n){const{actions:t}=this;if(this.active)return void t.push(n);let i;this.active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=t.shift());if(this.active=!1,i){for(;n=t.shift();)n.unsubscribe();throw i}}}const w=new d(class A extends H{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){if(this.closed)return this;this.state=n;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(s,this.id,t),this}requestAsyncId(n,t,i=0){return setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,t,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return t;clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let s,i=!1;try{this.work(n)}catch(l){i=!0,s=!!l&&l||new Error(l)}if(i)return this.unsubscribe(),s}_unsubscribe(){const n=this.id,t=this.scheduler,i=t.actions,s=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==s&&i.splice(s,1),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null}}),O=(()=>{function o(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return o.prototype=Object.create(Error.prototype),o})();var g=a(1177);class S{constructor(n,t,i,s){this.waitFor=n,this.absoluteTimeout=t,this.withObservable=i,this.scheduler=s}call(n,t){return t.subscribe(new p(n,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class p extends g.Ds{constructor(n,t,i,s,l){super(n),this.absoluteTimeout=t,this.waitFor=i,this.withObservable=s,this.scheduler=l,this.scheduleTimeout()}static dispatchTimeout(n){const{withObservable:t}=n;n._unsubscribeAndRecycle(),n.add((0,g.ft)(t,new g.IY(n)))}scheduleTimeout(){const{action:n}=this;n?this.action=n.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(p.dispatchTimeout,this.waitFor,this))}_next(n){this.absoluteTimeout||this.scheduleTimeout(),super._next(n)}_unsubscribe(){this.action=void 0,this.scheduler=null,this.withObservable=null}}var q=a(1737),x=a(4850),e=a(6738);let y=(()=>{class o{constructor(t){this.httpClient=t}get(t,i,s=o.RequestTimeout){return this.httpClient.get(o.Endpoint+"/"+t,{headers:new m.WM({"Ocp-Apim-Subscription-Key":o.PKey}),responseType:"json",params:i}).pipe(function N(o,n=w){return function M(o,n,t=w){return i=>{let s=function k(o){return o instanceof Date&&!isNaN(+o)}(o),l=s?+o-t.now():Math.abs(o);return i.lift(new S(l,s,n,t))}}(o,(0,q._)(new O),n)}(s),(0,x.U)(l=>l.data))}get_match(t,i=10,s="nl",l=["nevo","taste","portie","mealMoment","vc"]){return this.get("match",(new m.LE).set("keywords",t).set("language",s).set("max_result_count",i))}get_food_item_practical_units(t){return this.get("practical-units",(new m.LE).set("food_item_uri",t))}get_food_item_nutrients(t,i=["carbohydrate","energy kcal, total metabolisable"]){return this.get("nutrients",(new m.LE).set("food_item_uri",t)).pipe((0,x.U)(s=>s.filter(l=>i.includes(l.label_en))))}}return o.RequestTimeout=15e3,o.Endpoint="https://euw-apim-fism-001-p.azure-api.net",o.PKey="6249b10447f445fbad35e0a43f9e82b1",o.\u0275fac=function(t){return new(t||o)(e.LFG(m.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const I=["popover"];function L(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-button",12),e.NdJ("click",function(s){const c=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onFoodItemClick(s,c))}),e._UZ(4,"ion-icon",13),e.qZA(),e.TgZ(5,"ion-button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.onFoodItemAddClick(l))}),e._UZ(6,"ion-icon",14),e.qZA()()}if(2&o){const t=n.$implicit;e.xp6(2),e.Oqu(t.label)}}function U(o,n){if(1&o&&(e.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",15),e._uU(3),e.qZA(),e.TgZ(4,"ion-note",16),e._uU(5),e.qZA()()()),2&o){const t=n.$implicit;e.xp6(3),e.Oqu(t.label_en),e.xp6(2),e.Oqu(t.value)}}function D(o,n){if(1&o&&(e.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e._uU(3,"Food Info"),e.qZA(),e.TgZ(4,"ion-card-subtitle"),e._uU(5),e.qZA()(),e.TgZ(6,"ion-card-content"),e.YNc(7,U,6,2,"ion-list",6),e.qZA()()),2&o){const t=e.oxw();e.xp6(5),e.Oqu(t.selectedFoodItem.label),e.xp6(2),e.Q6J("ngForOf",t.selectedFoodItemNutrients)}}function J(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-button",12),e.NdJ("click",function(s){const c=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.onSelectedFoodStarIconClick(s,c))}),e._UZ(4,"ion-icon",17),e.qZA(),e.TgZ(5,"ion-button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.onSelectedFoodDeleteClick(l))}),e._UZ(6,"ion-icon",18),e.qZA()()}if(2&o){const t=n.$implicit;e.xp6(2),e.Oqu(t.label)}}function E(o,n){1&o&&e._UZ(0,"ion-datetime",26)}function G(o,n){if(1&o&&(e.TgZ(0,"ion-select-option",27),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function R(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item-group")(1,"ion-item")(2,"ion-label"),e._uU(3),e.qZA(),e.TgZ(4,"ion-button",28),e.NdJ("click",function(s){const c=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.onSelectedFoodStarIconClick(s,c))}),e._UZ(5,"ion-icon",17),e.qZA(),e.TgZ(6,"ion-button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onSelectedFoodDeleteClick(l))}),e._UZ(7,"ion-icon",18),e.qZA()()()}if(2&o){const t=n.$implicit;e.xp6(3),e.Oqu(t.label),e.xp6(1),e.Q6J("disabled",!0)}}function Q(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Register Meal"),e.qZA()()(),e.TgZ(4,"ion-content",19)(5,"ion-item-divider")(6,"ion-label"),e._uU(7,"Date/Time"),e.qZA()(),e.TgZ(8,"ion-grid")(9,"ion-row",9)(10,"ion-col"),e._UZ(11,"ion-datetime-button",20),e.qZA()()(),e.TgZ(12,"ion-modal",21),e.YNc(13,E,1,0,"ng-template"),e.qZA(),e.TgZ(14,"ion-item-divider")(15,"ion-label"),e._uU(16,"Meal Type"),e.qZA()(),e.TgZ(17,"ion-select",22),e.YNc(18,G,2,1,"ion-select-option",23),e.qZA(),e.TgZ(19,"ion-item-divider")(20,"ion-label"),e._uU(21,"Selected Food"),e.qZA()(),e.YNc(22,R,8,2,"ion-item-group",6),e.TgZ(23,"ion-grid")(24,"ion-row",9)(25,"ion-col")(26,"ion-button",24),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.modalConfirm())}),e._uU(27,"Confirm"),e.qZA(),e.TgZ(28,"ion-button",25),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.modalCancel())}),e._uU(29,"Cancel"),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(12),e.Q6J("keepContentsMounted",!0),e.xp6(6),e.Q6J("ngForOf",t.mealTypes),e.xp6(4),e.Q6J("ngForOf",t.selectedFoodList),e.xp6(4),e.Q6J("disabled",!t.payloadJSON)}}var h=(()=>{return(o=h||(h={})).BREAKFAST="Breakfast",o.LUNCH="Lunch",o.DINNER="Dinner",o.SNACK="Snack",h;var o})();const Y=[{path:"",component:(()=>{class o{constructor(t,i){this.foodService=t,this.loadingCtrl=i,this.foodList=[],this.favoritesFoodList=new Set,this.selectedFoodList=new Set,this.selectedFoodItemNutrients=[],this.mealTypes=[];for(const s of Object.values(h))this.mealTypes.push(s)}ngOnInit(){var t=this;return(0,Z.Z)(function*(){console.log("[->] Calling ngOnInit() ..."),console.log(t)})()}onMessage(t){console.log("[->] onMessage() ..."),console.log(t),console.log(t.data)}sendToParent(){console.log("[->] Sending 'this.selectedFoodList' as Activity to GB ..."),console.log("TODO: fill json/payload and send request");try{const t={activityForm:{gameDescriptor:1,dataProvider:1,miniGameUse:null,date:Date.now(),propertyInstances:[{property:1,value:"1000"},{property:2,value:null},{property:3,value:null},{property:66,value:null}],players:[328]}},i=JSON.stringify(t);console.log("Posting message to parent:\n"+i),window.parent.postMessage(i,"*")}catch(t){console.log("Exception thrown"+t.message)}}showLoading(t=(v=>{}),i=(()=>{}),s="Loading...",l=y.RequestTimeout,c=(()=>{}),u=(()=>{})){var v=this;return(0,Z.Z)(function*(){const _=yield v.loadingCtrl.create({message:s,duration:l});_.present().then(()=>t(_),c),_.onDidDismiss().then(i,u)})()}clearFoodList(){this.foodList=[]}onTest(){console.log("[->] onTest() ...")}onSearchChange(t){console.log("TRIGGERED: "+t.type),console.log("Query: "+t.target.value.toLowerCase());const i=t.target.value.toLowerCase().trim();i?.length?this.showLoading(s=>{this.now=Date.now(),console.log("[->] Loading..."),this.foodService.get_match(i).subscribe(l=>{this.foodList=l,l.forEach(c=>console.log(c.label)),s.dismiss()})},()=>{let s=(Date.now()-this.now)/1e3;console.log("[<-] Loading DONE! (in "+s+" seconds)"),t.target.setFocus()}):this.clearFoodList()}onSearchCancel(t){this.clearFoodList()}onSearchClear(t){this.clearFoodList()}onFoodItemClick(t,i){this.selectedFoodItem=i,console.log("uri: "+i.uri),this.showLoading(s=>{this.now=Date.now(),console.log("[->] Loading..."),this.foodService.get_food_item_nutrients(i.uri).subscribe(l=>{console.log(JSON.stringify(l,void 0,2)),this.selectedFoodItemNutrients=l,s.dismiss(),this.popover.event=t,this.isPopoverOpen=!0})},()=>{let s=(Date.now()-this.now)/1e3;console.log("[<-] Loading DONE! (in "+s+" seconds)")})}onFoodItemAddClick(t){this.selectedFoodList.add(t)}onSelectedFoodStarIconClick(t,i){"star"==t.target.children[0].name?(this.favoritesFoodList.delete(i),t.target.children[0].name="star-outline"):(this.favoritesFoodList.add(i),t.target.children[0].name="star")}onSelectedFoodDeleteClick(t){this.selectedFoodList.delete(t)}onCloseRegisterModal(t){this.isRegisterModalOpen=!1}modalCancel(){this.modal.dismiss(null,"cancel")}modalConfirm(){this.modal.dismiss(null,"confirm")}onRegisterModalWillDismiss(t){console.log(t.detail.role)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(y),e.Y36(r.HT))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-home"]],viewQuery:function(t,i){if(1&t&&(e.Gf(I,5),e.Gf(r.ki,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.popover=s.first),e.iGM(s=e.CRH())&&(i.modal=s.first)}},hostBindings:function(t,i){1&t&&e.NdJ("message",function(l){return i.onMessage(l)},!1,e.Jf7)},decls:32,vars:8,consts:[[3,"translucent"],["slot","end"],["fill","clear"],["slot","icon-only","name","help-circle-outline"],[3,"fullscreen"],["placeholder","Search by food name","show-clear-button","focus","show-cancel-button","focus",3,"debounce","ionCancel","ionChange","ionClear"],[4,"ngFor","ngForOf"],["size","auto","side","start",3,"isOpen","dismissOnSelect","didDismiss"],["popover",""],["justify-content-around",""],["id","open-register-modal","expand","block",3,"disabled"],["trigger","open-register-modal",3,"willDismiss"],["fill","clear",3,"click"],["slot","icon-only","name","information-circle-outline"],["slot","icon-only","name","add-circle-outline"],["slot","start"],["slot","end","color","primary"],["slot","icon-only","name","star-outline"],["slot","icon-only","name","trash-outline"],[1,"ion-padding"],["datetime","datetime"],[3,"keepContentsMounted"],["interface","popover","placeholder","Select meal type"],["value","breakfast",4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],["expand","block","color","danger",3,"click"],["id","datetime"],["value","breakfast"],["fill","clear",3,"disabled","click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3," Meal Intake "),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e._UZ(6,"ion-icon",3),e.qZA()()()(),e.TgZ(7,"ion-content",4)(8,"ion-searchbar",5),e.NdJ("ionCancel",function(l){return i.onSearchCancel(l)})("ionChange",function(l){return i.onSearchChange(l)})("ionClear",function(l){return i.onSearchClear(l)}),e.qZA(),e.TgZ(9,"ion-item-divider")(10,"ion-label"),e._uU(11,"Search Results"),e.qZA()(),e.TgZ(12,"ion-item-group"),e.YNc(13,L,7,1,"ion-item",6),e.qZA(),e.TgZ(14,"ion-popover",7,8),e.NdJ("didDismiss",function(){return i.isPopoverOpen=!1}),e.YNc(16,D,8,2,"ng-template"),e.qZA(),e.TgZ(17,"ion-item-divider")(18,"ion-label"),e._uU(19,"Selected"),e.qZA()(),e.TgZ(20,"ion-item-group"),e.YNc(21,J,7,1,"ion-item",6),e.qZA(),e.TgZ(22,"ion-grid")(23,"ion-row",9)(24,"ion-col")(25,"ion-button",10),e._uU(26,"Register Meal"),e.qZA()()()(),e.TgZ(27,"ion-modal",11),e.NdJ("willDismiss",function(l){return i.onRegisterModalWillDismiss(l)}),e.YNc(28,Q,30,4,"ng-template"),e.qZA()(),e.TgZ(29,"ion-footer")(30,"ion-toolbar"),e._UZ(31,"ion-title"),e.qZA()()),2&t&&(e.Q6J("translucent",!0),e.xp6(7),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("debounce",1e3),e.xp6(5),e.Q6J("ngForOf",i.foodList),e.xp6(1),e.Q6J("isOpen",i.isPopoverOpen)("dismissOnSelect",!0),e.xp6(7),e.Q6J("ngForOf",i.selectedFoodList),e.xp6(4),e.Q6J("disabled",i.selectedFoodList.size<=0))},dependencies:[b.sg,r.YG,r.Sm,r.PM,r.FN,r.Zi,r.tO,r.Dq,r.wI,r.W2,r.x4,r.Mj,r.fr,r.jY,r.Gu,r.gu,r.Ie,r.rH,r.Ub,r.Q$,r.q_,r.uN,r.Nd,r.VI,r.t9,r.n0,r.wd,r.sr,r.ki,r.d8,r.QI,r.j9],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}"]}),o})()}];let K=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[T.Bz.forChild(Y),T.Bz]}),o})(),$=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[b.ez,F.u5,r.Pc,K]}),o})()}}]);